

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Excursion: The Teeworlds map format &mdash; tml v0.2.3 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="tml v0.2.3 documentation" href="index.html" />
    <link rel="prev" title="Example scripts" href="example.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example.html" title="Example scripts"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">tml v0.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="excursion-the-teeworlds-map-format">
<h1>Excursion: The Teeworlds map format<a class="headerlink" href="#excursion-the-teeworlds-map-format" title="Permalink to this headline">¶</a></h1>
<p>In this chapter you will learn how a teeworlds map is structured. This
knowledge is not necessary for using tml, but it can be helpfull if you are
interested in understanding what is going on under the hood or just want
to hack a map yourself.</p>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<p>The first bytes just contain the word &#8220;DATA&#8221; or &#8220;ATAD&#8221; (little oder big endian),
it is the &#8220;signature&#8221; of a teeworlds map. After that there is an int which
contains the version of the mapformat, teeworlds 0.5 uses version 4 but also
supports 3, this libary only supports 4.</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">DATA\\x04\\x00\\x00\\x00</span></tt></div></blockquote>
<p>Then there are four more ints which can be read straight from the file.
These are &#8220;size&#8221;, &#8220;swaplen&#8221;, &#8220;num_item_types&#8221;, &#8220;num_items&#8221;, &#8220;num_raw_data&#8221;,
&#8220;item_size&#8221; and &#8220;data_size&#8221;.</p>
<p>Now the offsets can be calculated. This is important to seek directly to the
items or datas which contain the actual data.
The item offset is the sum of the following:</p>
<ul class="simple">
<li>num_item_types * 12 (one item type is composed of three int, one int is four
bytes)</li>
<li>num_items * 4</li>
<li>num_raw_data * 2 * 4</li>
</ul>
<p>To access the data an additional value gets added to the item offset</p>
<ul class="simple">
<li>item_size</li>
</ul>
</div>
<div class="section" id="item-types">
<h2>Item types<a class="headerlink" href="#item-types" title="Permalink to this headline">¶</a></h2>
<p>After the header the types are stored. For each item type there is a list
containing the type, the number of items for this type and which itme is the
first for this type. The list is sorted by item type and item id.</p>
</div>
<div class="section" id="item-offsets">
<h2>Item offsets<a class="headerlink" href="#item-offsets" title="Permalink to this headline">¶</a></h2>
<p>Right after the types the item offsets are stored. The first offset is 0. The
offset to the next item will be the size of the previous item. The size of each
item is as big as defined in <cite>mapitems.h</cite> (see teeworlds source) plus 2 more
integers containing the type, id and the item size.</p>
</div>
<div class="section" id="data-offsets">
<h2>Data offsets<a class="headerlink" href="#data-offsets" title="Permalink to this headline">¶</a></h2>
<p>After the item offsets the data offsets are stored. The first offset is 0. The
offset to the next data will be the size of the previous data. The size of each
data gets generated when saveing the map.</p>
</div>
<div class="section" id="uncompressed-data-sizes">
<h2>Uncompressed data sizes<a class="headerlink" href="#uncompressed-data-sizes" title="Permalink to this headline">¶</a></h2>
<p>The uncompressed data sizes are stored after the data offsets. The sizes are
used to allocate the memory for each data in teeworlds.</p>
</div>
<div class="section" id="items">
<h2>Items<a class="headerlink" href="#items" title="Permalink to this headline">¶</a></h2>
<p>Finally the items are stored. Every item will be stored with all its data in
this order:</p>
<ol class="arabic simple">
<li>version</li>
<li>info</li>
<li>images</li>
<li>envelops</li>
<li>groups</li>
<li>layers</li>
<li>envpoints</li>
</ol>
<p>Every item contains the data as defined in <cite>mapitems.h</cite> (see teeworlds source)
plus 2 more integers containing the type, id and the item size.
Type and id is within the first integer. To extract the type and id the
following formulas are used:</p>
<ul class="simple">
<li>type = (type_and_id &gt;&gt; 16) &amp; 0xffff</li>
<li>id = type_and_id &amp; 0xffff</li>
</ul>
</div>
<div class="section" id="datas">
<h2>Datas<a class="headerlink" href="#datas" title="Permalink to this headline">¶</a></h2>
<p>Eventually the datas are stored. The data is compressed using zlib. Each item
which requires data has an index which tells the position of the corresponding
data.
The compressed data part stores image names, tiles, quads and embedded images.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Excursion: The Teeworlds map format</a><ul>
<li><a class="reference internal" href="#header">Header</a></li>
<li><a class="reference internal" href="#item-types">Item types</a></li>
<li><a class="reference internal" href="#item-offsets">Item offsets</a></li>
<li><a class="reference internal" href="#data-offsets">Data offsets</a></li>
<li><a class="reference internal" href="#uncompressed-data-sizes">Uncompressed data sizes</a></li>
<li><a class="reference internal" href="#items">Items</a></li>
<li><a class="reference internal" href="#datas">Datas</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="example.html"
                        title="previous chapter">Example scripts</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/mapformat.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example.html" title="Example scripts"
             >previous</a> |</li>
        <li><a href="index.html">tml v0.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2012, TML Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>